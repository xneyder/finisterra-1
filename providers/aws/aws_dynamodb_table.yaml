aws_dynamodb_table:
  # terraform_module: "terraform-aws-modules/dynamodb-table/aws"
  # terraform_module: "../../../terraform-aws-modules/terraform-aws-dynamodb-table"
  terraform_module: "github.com/finisterra-io/terraform-aws-dynamodb-table.git?ref=main"
  terraform_module_version: "3.3.0"
  keys:
    - name
  target_resource_name:
    function: aws_dyanmodb_target_name
  defaults:
    autoscaling_enabled: false
    ignore_changes_global_secondary_index: true
  fields:
    name:
      field: name
      type: string
    billing_mode:
      field: billing_mode
      type: string
    hash_key:
      field: hash_key
      type: string
    range_key:
      field: range_key
      type: string
    read_capacity:
      field: read_capacity
      type: number
    write_capacity:
      field: write_capacity
      type: number
    stream_enabled:
      field: stream_enabled
      type: bool
    stream_view_type:
      field: stream_view_type
      type: string
    table_class:
      field: table_class
      type: string
    deletion_protection_enabled:
      field: deletion_protection_enabled
      type: bool
    ttl_enabled:
      function: get_field_from_attrs
      arg: ttl.enabled
      type: bool
    ttl_attribute_name:
      function: get_field_from_attrs
      arg: ttl.attribute_name
      type: string
    point_in_time_recovery_enabled:
      function: get_field_from_attrs
      arg: point_in_time_recovery.enabled
      type: bool
    attributes:
      field: attribute
      type: list
    local_secondary_indexes:
      field: local_secondary_index
      type: list
    global_secondary_indexes:
      field: global_secondary_index
      type: list
    replica_regions:
      field: replica
      type: list
    server_side_encryption_enabled:
      function: get_field_from_attrs
      arg: server_side_encryption.enabled
      type: bool
    server_side_encryption_kms_key_arn:
      function: get_field_from_attrs
      arg: server_side_encryption.kms_key_arn
      type: string
    tags:
      field: tags
      type: map
    timeouts:
      field: timeouts
      type: map
  childs:
    aws_appautoscaling_target:
      join:
        name:
          function: get_name_from_arn
          arg: resource_id
      defaults:
        autoscaling_enabled: true
      target_resource_name:
        function: aws_appautoscaling_target_name
      fields:
        autoscaling_read_enabled:
          function: autoscaling_read_enabled
          type: bool
        autoscaling_write_enabled:
          function: autoscaling_write_enabled
          type: bool
        read_capacity:
          field: min_capacity
          type: number
        write_capacity:
          field: min_capacity
          type: number
        read_max_capacity:
          field: max_capacity
          type: number
        write_max_capacity:
          field: max_capacity
          type: number
        autoscaling_read:
          function: autoscaling_read
          type: map
        autoscaling_write:
          function: autoscaling_write
          type: map

      childs:
        aws_appautoscaling_policy:
          join:
            resource_id:
              field: resource_id
            service_namespace:
              field: service_namespace
            scalable_dimension:
              field: scalable_dimension
          target_resource_name:
            function: aws_appautoscaling_policy_name
          fields:
            table_read_policy_name:
              function: table_read_policy_name
              type: string
            table_write_policy_name:
              function: table_write_policy_name
              type: string
            index_read_policy_name:
              function: index_read_policy_name
              type: string
            index_write_policy_name:
              function: index_write_policy_name
              type: string
            autoscaling_read:
              function: autoscaling_read
              type: map
            autoscaling_write:
              function: autoscaling_write
              type: map
