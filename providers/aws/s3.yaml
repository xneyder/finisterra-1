aws_s3_bucket:
  # terraform_module: "../../../terraform-aws-modules/terraform-aws-s3-bucket"
  terraform_module: "github.com/finisterra-io/terraform-aws-s3-bucket.git?ref=main"
  terraform_module_version: "3.14.0"
  name_field: bucket
  add_id_hash_to_name: true
  keys:
    - bucket
  target_resource_name: this
  fields:
    bucket:
      field: bucket
    bucket_prefix:
      field: bucket_prefix
    tags:
      field: tags
    force_destroy:
      field: force_destroy
      module_default: false
    object_lock_enabled:
      field: object_lock_enabled
      module_default: false
  defaults:
    attach_public_policy: false
  childs:
    aws_s3_bucket_logging:
      target_resource_name: this
      join:
        bucket:
          field: bucket
      fields:
        logging:
          function: build_logging
          type: map

    aws_s3_bucket_acl:
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        acl:
          field: acl
        expected_bucket_owner:
          field: expected_bucket_owner
        grant:
          function: aws_s3_bucket_acl_grant
        owner:
          function: aws_s3_bucket_acl_owner

    aws_s3_bucket_website_configuration:
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        website:
          function: aws_s3_bucket_website_configuration_website
        expected_bucket_owner:
          field: expected_bucket_owner

    aws_s3_bucket_versioning:
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        versioning:
          function: aws_s3_bucket_versioning_versioning
        expected_bucket_owner:
          field: expected_bucket_owner

    aws_s3_bucket_server_side_encryption_configuration:
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        server_side_encryption_configuration:
          function: server_side_encryption_configuration
        expected_bucket_owner:
          field: expected_bucket_owner

    aws_s3_bucket_accelerate_configuration:
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        acceleration_status:
          field: status
        expected_bucket_owner:
          field: expected_bucket_owner

    aws_s3_bucket_request_payment_configuration:
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        request_payer:
          field: payer
        expected_bucket_owner:
          field: expected_bucket_owner

    aws_s3_bucket_cors_configuration: #Not tested
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        expected_bucket_owner:
          field: expected_bucket_owner
        cors_rule:
          field: cors_rule

    aws_s3_bucket_lifecycle_configuration:
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        expected_bucket_owner:
          field: expected_bucket_owner
        lifecycle_rule:
          function: aws_s3_bucket_lifecycle_configuration_lifecycle_rule

    aws_s3_bucket_object_lock_configuration:
      join:
        bucket:
          field: bucket
      target_resource_name: this
      defaults:
        create_object_lock_configuration: true
      fields:
        object_lock_configuration_token:
          field: token
          type: string
        object_lock_configuration_object_lock_enabled:
          field: object_lock_enabled
          type: string
        expected_bucket_owner:
          field: expected_bucket_owner
          type: string
        object_lock_configuration_rule:
          function: get_object_lock_configuration_rule
          # field: rule
          type: list

    aws_s3_bucket_replication_configuration:
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        replication_configuration:
          function: build_replication_configuration
          arg: id

    aws_s3_bucket_policy:
      join:
        bucket:
          field: bucket
      target_resource_name: this
      defaults:
        attach_policy: true
        # block_public_policy: false
        # ignore_public_acls: false
        # restrict_public_buckets: false
      fields:
        policy:
          function: aws_s3_bucket_policy_policy
          arg: policy
          multiline: true

        # attach_policy:
        #   function: is_field_set
        #   arg: policy

    aws_s3_bucket_public_access_block:
      join:
        bucket:
          field: bucket
      target_resource_name: this
      defaults:
        attach_public_policy: true
      fields:
        block_public_acls:
          field: block_public_acls
          module_default: true
        block_public_policy:
          field: block_public_policy
          module_default: true
        ignore_public_acls:
          field: ignore_public_acls
          module_default: true
        restrict_public_buckets:
          field: restrict_public_buckets
          module_default: true

    aws_s3_bucket_ownership_controls: #no tested
      join:
        bucket:
          field: bucket
      target_resource_name: this
      defaults:
        control_object_ownership: true
      fields:
        object_ownership:
          function: aws_s3_bucket_ownership_controls_object_ownership

    aws_s3_bucket_intelligent_tiering_configuration: #no tested
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        intelligent_tiering:
          field: intelligent_tiering

    aws_s3_bucket_metric: #no tested
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        metric_configuration:
          field: metric_configuration

    aws_s3_bucket_inventory: #no tested
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        inventory_configuration:
          field: inventory_configuration

    aws_s3_bucket_analytics_configuration: #no tested
      join:
        bucket:
          field: bucket
      target_resource_name: this
      fields:
        analytics_configuration:
          field: analytics_configuration
