aws_rds_cluster:
  terraform_module: "../../../terraform-aws-modules/terraform-aws-rds-aurora"
  # terraform_module: "github.com/finisterra-io/terraform-aws-rds-aurora.git?ref=main"
  terraform_module_version: "6.1.0"
  target_resource_name: this
  name_field: cluster_identifier
  defaults:
    create_db_subnet_group: false
    manage_master_user_password: false
    create_security_group: false

  fields:
    init:
      function: init_cluster_attributes
    allocated_storage:
      field: allocated_storage
      type: number
    availability_zones:
      field: availability_zones
      type: list
    backup_retention_period:
      field: backup_retention_period
      type: number
    backtrack_window:
      field: backtrack_window
      type: number
    cluster_identifier:
      field: cluster_identifier
      type: string
    # cluster_identifier_prefix:
    #   field: identifier_prefix
    #   type: string
    cluster_members:
      field: cluster_members
      type: list
    copy_tags_to_snapshot:
      field: copy_tags_to_snapshot
      type: bool
    database_name:
      field: database_name
      type: string
    instance_class:
      field: db_cluster_instance_class
      type: string
    db_cluster_parameter_group_name:
      field: db_cluster_parameter_group_name
      type: string
    db_cluster_db_instance_parameter_group_name:
      field: db_instance_parameter_group_name
      type: string
    allow_major_version_upgrade:
      field: allow_major_version_upgrade
      type: bool
    db_subnet_group_name:
      field: db_subnet_group_name
      type: string
    deletion_protection:
      field: deletion_protection
      type: bool
    enable_global_write_forwarding:
      field: enable_global_write_forwarding
      type: bool
    enabled_cloudwatch_logs_exports:
      field: enabled_cloudwatch_logs_exports
      type: list
    enable_http_endpoint:
      field: enable_http_endpoint
      type: bool
    engine:
      field: engine
      type: string
    engine_mode:
      field: engine_mode
      type: string
    engine_version:
      field: engine_version
      type: string
    final_snapshot_identifier:
      field: final_snapshot_identifier
      type: string
    global_cluster_identifier:
      field: global_cluster_identifier
      type: string
    iam_database_authentication_enabled:
      field: iam_database_authentication_enabled
      type: bool
    iops:
      field: iops
      type: number
    kms_key_id:
      field: kms_key_id
      type: string
    manage_master_user_password:
      field: manage_master_user_password
      type: bool
    master_user_secret_kms_key_id:
      field: master_user_secret_kms_key_id
      type: string
    master_username:
      field: master_username
      type: string
    network_type:
      field: network_type
      type: string
    port:
      field: port
      type: number
    preferred_backup_window:
      field: preferred_backup_window
      type: string
    preferred_maintenance_window:
      field: preferred_maintenance_window
      type: string
    replication_source_identifier:
      field: replication_source_identifier
      type: string
    restore_to_point_in_time:
      field: restore_to_point_in_time
      type: list
    s3_import:
      field: s3_import
      type: map
    scaling_configuration:
      field: scaling_configuration
      type: map
    serverlessv2_scaling_configuration:
      field: serverlessv2_scaling_configuration
      type: map
    skip_final_snapshot:
      field: skip_final_snapshot
      type: bool
    snapshot_identifier:
      field: snapshot_identifier
      type: string
    source_region:
      field: source_region
      type: string
    storage_encrypted:
      field: storage_encrypted
      type: bool
    storage_type:
      field: storage_type
      type: string
    tags:
      field: tags
      type: map
    vpc_security_group_ids:
      field: vpc_security_group_ids
      type: list
    auto_minor_version_upgrade:
      field: auto_minor_version_upgrade
      type: bool
  childs:
    aws_rds_cluster_instance:
      join:
        cluster_identifier:
          field: cluster_identifier
      target_resource_name: this
      second_index:
        function: get_instance_identifier
      fields:
        instances:
          function: build_instances
          type: map
