aws_api_gateway_rest_api:
  # terraform_module: "../../../terraform-aws-modules/terraform-aws-api-gateway"
  terraform_module: "github.com/finisterra-io/terraform-aws-api-gateway.git?ref=main"
  terraform_module_version: "0.20.0"
  target_resource_name: this
  defaults:
    enabled: true
  add_id_hash_to_name: true
  fields:
    name:
      field: name
      type: string
    description:
      field: description
      type: string
    body:
      field: body
      type: string
      multiline: true
    endpoint_type:
      function: get_field_from_attrs
      arg: endpoint_configuration.types
      type: string
    tags:
      field: tags
      type: map
  childs:
    aws_api_gateway_deployment:
      join:
        id:
          field: rest_api_id
      target_resource_name: this
      import_id:
        function: aws_api_gateway_deployment_import_id
      second_index:
        field: id
      # defaults:
      #   create_api_gateway_deployment: true
      fields:
        deployments:
          function: build_deployments
          type: map
          arg: id
    aws_api_gateway_stage:
      join:
        id:
          field: rest_api_id
      target_resource_name: this
      # defaults:
      #   create_api_gateway_stage: true
      second_index:
        function: get_stage_name_index
      fields:
        deployments:
          function: build_stages
          type: map
          arg: id

    aws_api_gateway_method_settings:
      join:
        id:
          field: rest_api_id
      target_resource_name: all
      second_index:
        function: get_gateway_method_settings
      fields:
        api_gateway_method_settings:
          function: build_api_gateway_method_settings
          type: map
          arg: id

    aws_api_gateway_vpc_link:
      join:
        id:
          field: rest_api_id
      target_resource_name: this
      defaults:
        vpc_link_enabled: true
      fields:
        vpc_link_name:
          field: name
          type: string
        vpc_link_description:
          field: description
          type: string
        private_link_target_arns:
          field: target_arns
          type: list
