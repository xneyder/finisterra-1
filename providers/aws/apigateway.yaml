aws_api_gateway_rest_api:
  # terraform_module: "../../../terraform-aws-modules/terraform-aws-api-gateway"
  terraform_module: "github.com/finisterra-io/terraform-aws-api-gateway.git?ref=main"
  terraform_module_version: "0.20.0"
  target_resource_name: this
  defaults:
    enabled: true
  fields:
    name:
      field: name
      type: string
    description:
      field: description
      type: string
    body:
      field: body
      type: string
      multiline: true
    endpoint_type:
      function: get_field_from_attrs
      arg: endpoint_configuration.types
      type: string
    tags:
      field: tags
      type: map
  childs:
    aws_api_gateway_deployment:
      join:
        id:
          field: rest_api_id
      target_resource_name: this
      import_id:
        function: aws_api_gateway_deployment_import_id
      defaults:
        create_api_gateway_deployment: true
    aws_api_gateway_stage:
      join:
        id:
          field: rest_api_id
      target_resource_name: this
      defaults:
        create_api_gateway_stage: true
      fields:
        stage_name:
          field: stage_name
          type: string
        xray_tracing_enabled:
          field: xray_tracing_enabled
          type: bool
        stage_tags:
          field: tags
          type: map
        access_log_settings:
          field: access_log_settings
          type: string
        stage_variables:
          field: variables
          type: map
    aws_api_gateway_method_settings:
      join:
        id:
          field: rest_api_id
      target_resource_name: all
      fields:
        method_path:
          field: method_path
          type: string
        cache_data_encrypted:
          function: get_field_from_attrs
          arg: settings.cache_data_encrypted
          type: bool
        cache_ttl_in_seconds:
          function: get_field_from_attrs
          arg: settings.cache_ttl_in_seconds
          type: number
        caching_enabled:
          function: get_field_from_attrs
          arg: settings.caching_enabled
          type: bool
        data_trace_enabled:
          function: get_field_from_attrs
          arg: settings.data_trace_enabled
          type: bool
        logging_level:
          function: get_field_from_attrs
          arg: settings.logging_level
          type: string
        metrics_enabled:
          function: get_field_from_attrs
          arg: settings.metrics_enabled
          type: bool
        require_authorization_for_cache_control:
          function: get_field_from_attrs
          arg: settings.require_authorization_for_cache_control
          type: bool
        throttling_burst_limit:
          function: get_field_from_attrs
          arg: settings.throttling_burst_limit
          type: number
        throttling_rate_limit:
          function: get_field_from_attrs
          arg: settings.throttling_rate_limit
          type: number
        unauthorized_cache_control_header_strategy:
          function: get_field_from_attrs
          arg: settings.unauthorized_cache_control_header_strategy
          type: string

    aws_api_gateway_vpc_link:
      join:
        id:
          field: rest_api_id
      target_resource_name: this
      defaults:
        vpc_link_enabled: true
      fields:
        vpc_link_name:
          field: name
          type: string
        vpc_link_description:
          field: description
          type: string
        private_link_target_arns:
          field: target_arns
          type: list
