aws_iam_role:
  terraform_module: "github.com/finisterra-io/terraform-aws-modules.git//iam/modules/iam_role?ref=main"
  terraform_module_version: "5.2.0"
  target_resource_name: default
  name_field: role_name
  # path: "iam_role"
  # dependencies:
  #   - "../iam_policy"
  joined_fields:
    managed_policy_arns:
      sub_fields:
        - ALL
  fields:
    role_name:
      field: name
      type: string
    assume_role_policy:
      field: assume_role_policy
      type: string
      multiline: true
    role_description:
      field: description
      type: string
    max_session_duration:
      field: max_session_duration
      type: number
    inline_policies:
      function: get_inline_policies
      type: list
    permissions_boundary:
      field: permissions_boundary
      type: string
    path:
      field: path
      type: string
    tags:
      field: tags
      type: map
    managed_policy_arns:
      function: iam_get_managed_policy_arns
      arg: id
      type: map
  childs:
    aws_iam_role_policy_attachment:
      join:
        name:
          field: role
      target_resource_name: managed
      second_index:
        function: get_policy_attachment_index
    aws_iam_instance_profile:
      join:
        name:
          field: role
      target_resource_name: default
      second_index:
        field: name
      fields:
        instance_profiles:
          function: get_instance_profiles
          type: list

aws_iam_policy:
  terraform_module: "github.com/finisterra-io/terraform-aws-modules.git//iam/modules/iam_policy?ref=main"
  terraform_module_version: "5.2.0"
  target_resource_name: default
  name_field: policy_name
  # path: "iam_policy"
  fields:
    policy_documents:
      function: get_policy_documents
      type: string
      multiline: true
    policy_name:
      field: name
      type: string
    policy_description:
      field: description
      type: string
    path:
      field: path
      type: string
    tags:
      field: tags
      type: map
