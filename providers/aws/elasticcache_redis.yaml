aws_elasticache_replication_group:
  # terraform_module: "../../../terraform-aws-modules/terraform-aws-elasticache-redis"
  terraform_module: "github.com/finisterra-io/terraform-aws-elasticache-redis.git?ref=main"
  terraform_module_version: "0.20.0"
  target_resource_name: default
  name_field: replication_group_id
  defaults:
    enabled: true
    # cloudwatch_metric_alarms_enabled: false
    create_parameter_group_name: false
    create_subnet_group_name: false
    create_security_group: false
  fields:
    auth_token:
      field: auth_token
      type: string
    transit_encryption_enabled:
      field: transit_encryption_enabled
      type: bool
      module_default: true
    replication_group_id:
      field: replication_group_id
      type: string
    description:
      field: description
      type: string
    instance_type:
      field: node_type
      type: string
    num_cache_clusters:
      field: num_cache_clusters
      type: number
    port:
      field: port
      type: number
    parameter_group_name:
      field: parameter_group_name
      type: string
    preferred_cache_cluster_azs:
      field: preferred_cache_cluster_azs
      type: list
    automatic_failover_enabled:
      field: automatic_failover_enabled
      type: bool
      module_default: false
    multi_az_enabled:
      field: multi_az_enabled
      type: bool
      module_default: false
    subnet_group_name:
      field: subnet_group_name
      type: string
    maintenance_window:
      field: maintenance_window
      type: string
      module_default: "wed:03:00-wed:04:00"
    notification_topic_arn:
      field: notification_topic_arn
      type: string
    engine_version:
      field: engine_version
      type: string
    at_rest_encryption_enabled:
      field: at_rest_encryption_enabled
      type: bool
      module_default: false
    kms_key_id:
      field: kms_key_id
      type: string
    snapshot_name:
      field: snapshot_name
      type: string
    snapshot_arns:
      field: snapshot_arns
      type: list
    snapshot_window:
      field: snapshot_window
      type: string
      module_default: "06:30-07:30"
    snapshot_retention_limit:
      field: snapshot_retention_limit
      type: number
      module_default: 0
    final_snapshot_identifier:
      field: final_snapshot_identifier
      type: string
    apply_immediately:
      field: apply_immediately
      type: bool
      module_default: true
    data_tiering_enabled:
      field: data_tiering_enabled
      type: bool
      module_default: false
    auto_minor_version_upgrade:
      function: auto_minor_version_upgrade
      type: bool
    log_delivery_configuration:
      field: log_delivery_configuration
      type: map
    tags:
      field: tags
      type: map
    cluster_mode_num_node_groups:
      field: num_node_groups
      type: number
      module_default: 0
    cluster_mode_replicas_per_node_group:
      field: replicas_per_node_group
      type: number
      module_default: 0
    user_group_ids:
      field: user_group_ids
      type: list
    security_group_names:
      field: security_group_names
      type: list

  childs:
    aws_elasticache_subnet_group:
      join:
        subnet_group_name:
          field: name
      target_resource_name: default
      fields:
        create_subnet_group_name:
          unique: true
        subnet_group_name:
          field: name
          type: string
        subnet_group_description:
          field: description
          type: string
        subnet_ids:
          function: get_subnet_ids
          arg: subnet_ids
          type: list
        subnet_names:
          function: get_subnet_names
          arg: subnet_ids
          type: list
        subnet_group_tags:
          field: tags
          type: map

    aws_elasticache_parameter_group:
      join:
        parameter_group_name:
          field: name
      target_resource_name: default
      fields:
        create_parameter_group_name:
          unique: true
        parameter_group_name:
          field: name
          type: string
        parameter_group_description:
          field: description
          type: string
        family:
          field: family
          type: string
        parameter:
          field: parameter
          type: list
        parameter_group_tags:
          field: tags
          type: map

    aws_security_group:
      join:
        id:
          join_function: match_security_group
      target_resource_name: default
      fields:
        create_security_group:
          unique: true
        security_group_name:
          field: name
          type: string
        vpc_id:
          function: get_vpc_id
          type: string
          arg: vpc_id
        vpc_name:
          function: get_vpc_name
          type: string
          arg: vpc_id
        security_group_description:
          field: description
          type: string
        security_group_tags:
          field: tags
          type: map
      childs:
        aws_security_group_rule:
          join:
            id:
              field: security_group_id
          target_resource_name: default
          second_index:
            field: id
          import_id:
            function: aws_security_group_rule_import_id
          fields:
            create_security_group:
              unique: true
            security_group_rules:
              function: get_security_group_rules
              arg: id
              type: list
