aws_docdb_cluster:
  # terraform_module: "terraform-aws-modules/rds/documentdb-cluster"
  # terraform_module: "../../../terraform-aws-modules/terraform-aws-documentdb-cluster"
  terraform_module: "github.com/finisterra-io/terraform-aws-documentdb-cluster.git?ref=main"
  terraform_module_version: "0.20.0"
  target_resource_name: default
  defaults:
    enabled: true
    create_random_password: false
  fields:
    cluster_identifier:
      field: cluster_identifier
      type: string
    final_snapshot_identifier:
      field: final_snapshot_identifier
      type: string
    master_username:
      field: master_username
      type: string
    master_password:
      field: master_password
      type: string
    retention_period:
      field: backup_retention_period
      type: number
    preferred_backup_window:
      field: preferred_backup_window
      type: string
    preferred_maintenance_window:
      field: preferred_maintenance_window
      type: string
    skip_final_snapshot:
      field: skip_final_snapshot
      type: bool
    deletion_protection:
      field: deletion_protection
      type: bool
    apply_immediately:
      field: apply_immediately
      type: bool
    storage_encrypted:
      field: storage_encrypted
      type: bool
    kms_key_id:
      field: kms_key_id
      type: string
    db_port:
      field: port
      type: number
    snapshot_identifier:
      field: snapshot_identifier
      type: string
    engine:
      field: engine
      type: string
    engine_version:
      field: engine_version
      type: string
    enabled_cloudwatch_logs_exports:
      field: enabled_cloudwatch_logs_exports
      type: list
    db_cluster_parameter_group_name:
      field: db_cluster_parameter_group_name
      type: string
    tags:
      field: tags
      type: map
  childs:
    aws_docdb_cluster_instance:
      join:
        id:
          field: cluster_identifier
      target_resource_name: default
      second_index:
        field: identifier
      fields:
        cluster_instances:
          function: build_dict_var
          arg: identifier
          type: map

    aws_docdb_subnet_group:
      join:
        db_subnet_group_name:
          field: name
      defaults:
        enable_aws_docdb_subnet_group: true
      target_resource_name: default
      fields:
        subnet_ids:
          field: subnet_ids
          type: list
        db_subnet_group_name:
          field: name
          type: string
        db_subnet_group_tags:
          field: tags
          type: map
        db_subnet_group_description:
          field: description
          type: string

    aws_docdb_cluster_parameter_group:
      join:
        db_cluster_parameter_group_name:
          field: name
      target_resource_name: default
      defaults:
        enable_aws_docdb_cluster_parameter_group: true
      fields:
        cluster_parameter_group_name:
          field: name
          type: string
        cluster_parameter_group_description:
          field: description
          type: string
        cluster_parameters:
          field: parameters
          type: list
        cluster_parameter_group_tags:
          field: tags
          type: map

    aws_security_group:
      join:
        id:
          join_function: match_security_group
      target_resource_name: default
      fields:
        security_group_name:
          field: name
          type: string
        vpc_id:
          field: vpc_id
          type: string
        security_group_description:
          field: description
          type: string
        security_group_tags:
          field: tags
          type: map
      childs:
        aws_security_group_rule:
          join:
            id:
              field: security_group_id
          target_resource_name: default
          second_index:
            field: id
          fields:
            security_group_rules:
              function: build_dict_var
              arg: id
              type: list
