aws_sfn_state_machine:
  terraform_module: "github.com/finisterra-io/terraform-aws-modules.git//step-functions?ref=main"
  terraform_module_version: "5.1.0"
  target_resource_name: this
  defaults:
    create: true
    create_role: false
    # use_existing_role: false
    create_cloudwatch_log_group: false
  # path: "stepfunction"
  fields:
    name:
      field: name
      type: string
    role_name:
      function: get_role_name_from_arn
      arg: role_arn
      type: string
    definition:
      field: definition
      type: string
      multiline: true
    logging_configuration:
      field: logging_configuration
      type: map
    tracing_configuration:
      field: tracing_configuration
      type: map
    type:
      field: type
      type: string
    tags:
      field: tags
      type: map
  childs:
    aws_cloudwatch_log_group:
      join:
        name:
          join_function: join_log_group
      target_resource_name: sfn
      fields:
        create_cloudwatch_log_group:
          unique: true
        cloudwatch_log_group_name:
          field: name
          type: string
        cloudwatch_log_group_retention_in_days:
          field: retention_in_days
          type: number
        cloudwatch_log_group_kms_key_id:
          field: kms_key_id
          type: string
        cloudwatch_log_group_tags:
          field: tags
          type: map

    aws_iam_role:
      join:
        name:
          join_function: join_role
      target_resource_name: this
      fields:
        create_role:
          unique: true
        role_description:
          field: description
          type: string
        role_path:
          field: path
          type: string
        role_force_detach_policies:
          field: force_detach_policies
          type: bool
        role_permissions_boundary:
          field: permissions_boundary
          type: string
        assume_role_policy:
          field: assume_role_policy
          type: string
          multiline: true
        role_tags:
          field: tags
          type: map
      childs:
        aws_iam_role_policy_attachment:
          join:
            name:
              field: role
          target_resource_name: this
          second_index:
            field: policy_arn
          fields:
            create_role:
              unique: true
            policy_arns:
              function: to_list
              arg: policy_arn
              type: list
